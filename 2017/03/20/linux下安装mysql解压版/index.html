<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="杨东旭">
  <!-- Open Graph Data -->
  <meta property="og:title" content="linux下安装mysql解压版"/>
  <meta property="og:description" content="" />
  <meta property="og:site_name" content="Hexo"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://yoursite.comundefined"/>
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>Hexo</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">linux下安装mysql解压版</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/levblanc">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:levblanc@163.com">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By 杨东旭</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2017-03-20</span>
            <span class="time">13:00:04</span>
          </span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/dddd/">#dddd</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <h4 id="1、下载安装包"><a href="#1、下载安装包" class="headerlink" title="1、下载安装包"></a>1、下载安装包</h4><p><a href="http://dev.mysql.com/downloads/mysql/#downloads" target="_blank" rel="external">http://dev.mysql.com/downloads/mysql/#downloads</a><br>推荐下载通用安装方法的TAR包<br>2.检查库文件是否存在，如有删除。</p>
<p>[root@localhost Desktop]$ rpm -qa | grep mysql<br>mysql-libs-5.1.52-1.el6_0.1.x86_64<br>[root@localhost ~]$ rpm -e mysql-libs-5.1.52.x86_64 –nodeps<br>[root@localhost ~]$</p>
<p>3.检查mysql组和用户是否存在，如无创建。</p>
<p>[root@localhost ~]$ cat /etc/group | grep mysql<br>mysql:x:490:<br>[root@localhost ~]$ cat /etc/passwd | grep mysql<br>mysql:x:496:490::/home/mysql:/bin/bash<br>以上为默认存在的情况，如无，执行添加命令：</p>
<p>[root@localhost ~]$groupadd mysql<br>[root@localhost ~]$useradd -r -g mysql mysql<br>//useradd -r参数表示mysql用户是系统用户，不可用于登录系统。<br>4.解压TAR包，更改所属的组和用户</p>
<p>[root@localhost ~]$ cd /usr/local/<br>[root@localhost local]$ tar xvf mysql-5.7.12-linux-glibc2.5-x86_64.tar<br>[root@localhost local]$ ls -l<br>total 1306432<br>-rwxr–r–. 1 root root  668866560 Jun  1 15:07 mysql-5.7.12-linux-glibc2.5-x86_64.tar<br>-rw-r–r–. 1 7161 wheel 638960236 Mar 28 12:54 mysql-5.7.12-linux-glibc2.5-x86_64.tar.gz<br>-rw-r–r–. 1 7161 wheel  29903372 Mar 28 12:48 mysql-test-5.7.12-linux-glibc2.5-x86_64.tar.gz<br>[root@localhost local]$ tar xvfz mysql-5.7.12-linux-glibc2.5-x86_64.tar.gz<br>[root@localhost local]$ mv mysql-5.7.12-linux-glibc2.5-x86_64 mysql<br>[root@localhost local]$ ls -l<br>total 1306436<br>drwxr-xr-x. 2 root root       4096 Dec  4  2009 bin<br>drwxr-xr-x. 2 root root       4096 Dec  4  2009 etc<br>drwxr-xr-x. 2 root root       4096 Dec  4  2009 games<br>drwxr-xr-x. 2 root root       4096 Dec  4  2009 include<br>drwxr-xr-x. 2 root root       4096 Dec  4  2009 lib<br>drwxr-xr-x. 3 root root       4096 Dec  2 14:36 lib64<br>drwxr-xr-x. 2 root root       4096 Dec  4  2009 libexec<br>drwxr-xr-x. 9 7161 wheel      4096 Mar 28 12:51 mysql<br>-rwxr–r–. 1 root root  668866560 Jun  1 15:07 mysql-5.7.12-linux-glibc2.5-x86_64.tar<br>-rw-r–r–. 1 7161 wheel 638960236 Mar 28 12:54 mysql-5.7.12-linux-glibc2.5-x86_64.tar.gz<br>-rw-r–r–. 1 7161 wheel  29903372 Mar 28 12:48 mysql-test-5.7.12-linux-glibc2.5-x86_64.tar.gz<br>drwxr-xr-x. 2 root root       4096 Dec  4  2009 sbin<br>drwxr-xr-x. 6 root root       4096 Dec  2 14:36 share<br>drwxr-xr-x. 2 root root       4096 Dec  4  2009 src<br>[root@localhost local]$ chown -R mysql mysql/<br>[root@localhost local]$ chgrp -R mysql mysql/<br>[root@localhost local]$ cd mysql/</p>
<p>5.安装和初始化数据库</p>
<p>[root@localhost mysql]$ bin/mysql_install_db –user=mysql –basedir=/usr/local/mysql/ –datadir=/usr/local/mysql/data/<br>2016-06-01 15:23:25 [WARNING] mysql_install_db is deprecated. Please consider switching to mysqld –initialize<br>2016-06-01 15:23:30 [WARNING] The bootstrap log isn’t empty:<br>2016-06-01 15:23:30 [WARNING] 2016-06-01T22:23:25.491840Z 0 [Warning] –bootstrap is deprecated. Please consider using –initialize instead<br>2016-06-01T22:23:25.492256Z 0 [Warning] Changed limits: max_open_files: 1024 (requested 5000)<br>2016-06-01T22:23:25.492260Z 0 [Warning] Changed limits: table_open_cache: 431 (requested 2000)</p>
<pre><code>如果改变默认安装路径，则需要
1）/etc/my.cnf、/etc/init.d/mysqld中修改
basedir=’/apps/mysql’
datadir=’/apps/mysql/data’
2）创建ln
mkdir -p /usr/local/mysql/bin
ln -s /apps/mysql/bin/mysqld /usr/local/mysql/bin/mysqld
</code></pre><p>[root@localhost mysql]$</p>
<p>[root@localhost mysql]$ cp -a ./support-files/my-default.cnf /etc/my.cnf<br>[root@localhost mysql]$ cp -a ./support-files/mysql.server  /etc/init.d/mysqld</p>
<p>[root@localhost mysql]$ cd bin/<br>[root@localhost bin]# ./mysqld_safe –user=mysql &amp;<br>[1] 2932<br>[root@localhost bin]# 2016-06-01T22:27:09.708557Z mysqld_safe Logging to ‘/usr/local/mysql/data/localhost.localdomain.err’.<br>2016-06-01T22:27:09.854913Z mysqld_safe Starting mysqld daemon with databases from /usr/local/mysql/data</p>
<p>[root@localhost bin]# /etc/init.d/mysqld restart<br>Shutting down MySQL..2016-06-01T22:27:50.498694Z mysqld_safe mysqld from pid file /usr/local/mysql/data/localhost.localdomain.pid ended<br> SUCCESS!<br>Starting MySQL. SUCCESS!<br>[1]+  Done                    ./mysqld_safe –user=mysql<br>[root@localhost bin]$<br>//设置开机启动<br>[root@localhost bin]$ chkconfig –level 35 mysqld on<br>[root@localhost bin]$</p>
<p>6.初始化密码</p>
<p>mysql5.7会生成一个初始化密码，而在之前的版本首次登陆不需要登录。</p>
<p>[root@localhost bin]$ cat /root/.mysql_secret</p>
<h1 id="Password-set-for-user-‘root-localhost’-at-2016-06-01-15-23-25"><a href="#Password-set-for-user-‘root-localhost’-at-2016-06-01-15-23-25" class="headerlink" title="Password set for user ‘root@localhost’ at 2016-06-01 15:23:25"></a>Password set for user ‘root@localhost’ at 2016-06-01 15:23:25</h1><p>,xxxxxR5H9<br>[root@localhost bin]$./mysql -uroot -p<br>Enter password:<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 2<br>Server version: 5.7.12</p>
<p>Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</p>
<p>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.</p>
<p>Type ‘help;’ or ‘\h’ for help. Type ‘\c’ to clear the current input statement.</p>
<p>mysql&gt; SET PASSWORD = PASSWORD(‘123456’);<br>Query OK, 0 rows affected, 1 warning (0.00 sec)</p>
<p>mysql&gt; flush privileges;<br>Query OK, 0 rows affected (0.00 sec)</p>
<p>7.添加远程访问权限</p>
<p>mysql&gt; use mysql;<br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A</p>
<p>Database changed<br>mysql&gt; update user set host = ‘%’ where user = ‘root’;<br>Query OK, 1 row affected (0.00 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0</p>
<p>mysql&gt; select host, user from user;<br>+———–+———–+<br>| host      | user      |<br>+———–+———–+<br>| %         | root      |<br>| localhost | mysql.sys |<br>+———–+———–+<br>//重启生效<br>/etc/init.d/mysqld restart</p>
<p> 在Centos6.6上安装MySQL5.7.12,后在/root目录下没有发现有.mysql_secret这个文件，所以没有没法按照官方文档上说的那样使用，这里记录下，</p>
<p>解决方式：</p>
<p>首先修改MySQL授权登录方式—（跳过授权验证方式启动MySQL）：<br>[root@test ~]# mysqld_safe –skip-grant-tables &amp;<br>[1] 3401<br>[root@test ~]# 2016-05-19T12:47:56.564385Z mysqld_safe Logging to ‘/var/log/mysqld.log’.<br>2016-05-19T12:47:56.589376Z mysqld_safe Starting mysqld daemon with databases from /var/lib/mysql</p>
<p>检查MySQL启动情况<br>[root@test ~]# ps -ef | grep mysql<br>root      3401  2880  0 20:47 pts/1    00:00:00 /bin/sh /usr/bin/mysqld_safe –skip-grant-tables<br>mysql     3548  3401  0 20:47 pts/1    00:00:00 /usr/sbin/mysqld –basedir=/usr –datadir=/var/lib/mysql –plugin-dir=/usr/lib64/mysql/plugin –user=mysql –skip-grant-tables –log-error=/var/log/mysqld.log –pid-file=/var/run/mysqld/mysqld.pid –socket=/var/lib/mysql/mysql.sock</p>
<p>这时登录MySQL不再需要验证<br>[root@test ~]# mysql</p>
<p>成功登录MySQL后：</p>
<p>切换到mysql系统库：<br>mysql&gt; use mysql;</p>
<p>修改root账户登录密码：<br>mysql&gt; update user set password=password(‘’) where user=’root’;<br>ERROR 1054 (42S22): Unknown column ‘password’ in ‘field list’<br>—报错没有password这个数据字段列</p>
<p>描述user表<br>mysql&gt; desc user;<br>…<br>| authentication_string  | text                              | YES  |     | NULL                  |       |<br>| password_expired       | enum(‘N’,’Y’)                     | NO   |     | N                     |       |<br>| password_last_changed  | timestamp                         | YES  |     | NULL                  |       |<br>| password_lifetime      | smallint(5) unsigned              | YES  |     | NULL                  |       |<br>| account_locked         | enum(‘N’,’Y’)                     | NO   |     | N                     |       |<br>+————————+———————————–+——+—–+———————–+——-+<br>—没发现password列，但是找到这5个跟密码相关的数据字段</p>
<p>查询一下相关的密码信息：<br>mysql&gt; select user,host,authentication_string,password_expired from user;<br>+———–+———–+——————————————-+——————+<br>| user      | host      | authentication_string                     | password_expired |<br>+———–+———–+——————————————-+——————+<br>| root      | localhost | <em>9AA01F6E2A80A823ACB72CC07337E2911404B5B8 | Y                |<br>| mysql.sys | localhost | </em>THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | N                |<br>+———–+———–+——————————————-+——————+<br>—到这里不难发现root账户的密码已过期，还比5.6多出了一个mysql.sys用户</p>
<p>修改密码<br>mysql&gt; update user set authentication_string=password(‘123abc’) where user=’root’;<br>Query OK, 1 row affected (0.00 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0</p>
<p>mysql&gt; flush privileges;<br>Query OK, 0 rows affected (0.00 sec)</p>
<p>mysql&gt; exit</p>
<p>密码修改成功,测试：</p>
<p>重启MySQL：<br>[root@test ～]# /etc/init.d/mysqld restart</p>
<p>登录测试:<br>[root@test ～]# mysql -p<br>Enter password:<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 3<br>Server version: 5.7.12-enterprise-commercial-advanced<br>…<br>mysql&gt; show databases;<br>ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.<br>—报错，需要使用alter user 修改密码</p>
<p>mysql&gt; alter user root@’localhost’ identified by ‘oracle’;<br>ERROR 1819 (HY000): Your password does not satisfy the current policy requirements<br>—报错，密码不满足制定的密码负责度要求</p>
<p>mysql&gt; alter user ‘root’@’localhost’ identified by ‘Abc!123D’;<br>Query OK, 0 rows affected (0.01 sec)</p>
<p>mysql&gt; show databases;<br>+——————–+<br>| Database           |<br>+——————–+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+——————–+<br>4 rows in set (0.00 sec)</p>
<p> 关于密码策略</p>
<p>mysql&gt; SHOW VARIABLES LIKE ‘validate_password%’;<br>+————————————–+——–+<br>| Variable_name                        | Value  |<br>+————————————–+——–+<br>| validate_password_dictionary_file    |        |<br>| validate_password_length             | 8      |<br>| validate_password_mixed_case_count   | 1      |<br>| validate_password_number_count       | 1      |<br>| validate_password_policy             | MEDIUM |<br>| validate_password_special_char_count | 1      |<br>+————————————–+——–+<br>6 rows in set (0.02 sec)</p>
<p>mysql&gt; show plugins;<br>+—————————-+———-+——————–+———————-+————-+<br>| Name                       | Status   | Type               | Library              | License     |<br>+—————————-+———-+——————–+———————-+————-+<br>| binlog                     | ACTIVE   | STORAGE ENGINE     | NULL                 | PROPRIETARY |</p>
<p>…<br>| validate_password          | ACTIVE   | VALIDATE PASSWORD  | validate_password.so | PROPRIETARY |<br>+—————————-+———-+——————–+———————-+————-+<br>—可以通过在配置文件[mysqld]标签中添加 validate_passwor=off ，来关闭密码策略<br>如下:<br>…<br>| validate_password          | DISABLED | VALIDATE PASSWORD  | validate_password.so | PROPRIETARY |<br>+—————————-+———-+——————–+———————-+————-+</p>
<p>总结</p>
<p>1) 安装好mysql后，第一次启动时，root管理密码会在/root/.mysql_secret中随机生成</p>
<p>2) 至5.7后，MySQL的 mysql.user 表中的密码字段由之前的 password 改为 authentication_string</p>
<p>3) 使用–skip-grant-tables 参数启动，跳过MySQL的授权验证，–skip-networking参数，跳过远程登录</p>
<p>4) 修改MySQL密码方式：</p>
<p>法1：update user set authentication_string=password(‘123abc’) where user=’root’;</p>
<p>法2：set password=password(‘newpassword’);</p>
<p>法3：alter user root@’localhost’ identified by ‘oracle’;</p>
<p>5) 关于MySQL密码策略：</p>
<p>决定是否使用该插件(及强制/永久强制使用)<br>–validate-password=ON/OFF/FORCE/FORCE_PLUS_PERMANENT</p>
<p>validate_password_dictionary_file　　&gt; 插件用于验证密码强度的字典文件路径。<br>validate_password_length     　　　　 &gt; 密码最小长度。<br>validate_password_mixed_case_count　　&gt; 密码至少要包含的小写字母个数和大写字母个数。<br>validate_password_number_count　　　　&gt; 密码至少要包含的数字个数。<br>validate_password_policy　　　　　  &gt; 密码强度检查等级，0/LOW、1/MEDIUM、2/STRONG。<br>validate_password_special_char_count　   &gt; 密码至少要包含的特殊字符数。</p>
<p>其中关于validate_password_policy-密码强度检查等级：<br>0/LOW　　　　&gt; 只检查长度。<br>1/MEDIUM　　&gt; 检查长度、数字、大小写、特殊字符。<br>2/STRONG　   &gt; 检查长度、数字、大小写、特殊字符字典文件。<br>后记</p>
<p>经过一段时间后，发现mysql初始密码原来被记录到了日志文件中</p>
<p>查找日志位置<br>[root@test /var/lib/mysql]# ps -ef | grep mysql<br>root      5604     1  0 22:40 pts/1    00:00:00 /bin/sh /usr/bin/mysqld_safe –datadir=/var/lib/mysql –socket=/var/lib/mysql/mysql.sock –pid-file=/var/run/mysqld/mysqld.pid –basedir=/usr –user=mysql<br>mysql     5802  5604  5 22:40 pts/1    00:00:00 /usr/sbin/mysqld –basedir=/usr –datadir=/var/lib/mysql –plugin-dir=/usr/lib64/mysql/plugin –user=mysql –log-error=/var/log/mysqld.log –pid-file=/var/run/mysqld/mysqld.pid –socket=/var/lib/mysql/mysql.sock<br>root      5837  2880  0 22:40 pts/1    00:00:00 grep –color mysql</p>
<p>藏在日志文件中的临时密码<br>[root@test /var/lib/mysql]# grep “A temporary password”  /var/log/mysqld.log<br>2016-05-17T16:46:53.059632Z 1 [Note] A temporary password is generated for root@localhost: +wGVA#to(4tu</p>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

